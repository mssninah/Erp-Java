
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/form.css" rel="stylesheet">

    <title>Créer un Supplier Quotation</title>

</head>
<body>
    <h1>Créer un Supplier Quotation</h1>

    <!-- Formulaire -->
<form action="/form" method="post">
    <!-- Fournisseur -->
    <label for="supplier">Fournisseur:</label>
    <select name="supplier" id="supplier" required>
        <th:block th:each="supplier : ${suppliers}">
            <option th:value="${supplier.name}" th:text="${supplier.name}"></option>
        </th:block>
    </select>
    <br><br>

    <!-- Date -->
    <label for="date">Date:</label>
    <input type="date" name="transaction_date" id="date" required>
    <br><br>

    <!-- Tableau des Items -->
    <h3>Items</h3>
    <table id="itemsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Item</th>
                <th>Quantité</th>
                <th>UOM</th>
                <th>Rate</th>
                <th>Entrepôt</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="itemsTableBody">
            <!-- Ligne par défaut -->
            <tr>
                <td>1</td>
                <td>
                    <select name="items[0][item_name]" required>
                        <option value="">-- Choisir un article --</option>
                        <th:block th:each="item : ${items}">
                            <option th:value="${item.item_name}" th:text="${item.item_name}"></option>
                        </th:block>
                    </select>
                </td>
                <td><input type="number" name="items[0][qty]" min="1" required></td>
                <td><input type="text" name="items[0][stock_uom]" value="Unit" readonly></td>
                <td><input type="number" name="items[0][rate]" value="0" readonly></td>
                <td>
                    <select name="items[0][warehouse]" required>
                        <option value="">-- Choisir un entrepôt --</option>
                        <th:block th:each="warehouse : ${warehouses}">
                            <option th:value="${warehouse.warehouse_name}" th:text="${warehouse.warehouse_name}"></option>
                        </th:block>
                    </select>
                </td>
                <td><button type="button" class="removeRow">Supprimer</button></td>
            </tr>
        </tbody>
    </table>
    <br>
    <button type="button" id="addRow">Ajouter une ligne</button>
    <br><br>

    <!-- Soumettre -->
    <button type="submit">Enregistrer</button>
</form>

<!-- Script JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const addRowButton = document.getElementById("addRow");
        const itemsTableBody = document.getElementById("itemsTableBody");

        addRowButton.addEventListener("click", function () {
            const rowIndex = itemsTableBody.children.length; // Index pour la nouvelle ligne
            const newRow = document.createElement("tr");

            newRow.innerHTML = `
                <td>${rowIndex + 1}</td>
                <td>
                    <select name="items[${rowIndex}][item_name]" required>
                        <option value="">-- Choisir un article --</option>
                        <!-- Les options seront dynamiquement injectées par Thymeleaf -->
                        <th:block th:each="item : ${items}">
                            <option th:value="\${item.item_name}" th:text="\${item.item_name}"></option>
                        </th:block>
                    </select>
                </td>
                <td><input type="number" name="items[${rowIndex}][qty]" min="1" required></td>
                <td><input type="text" name="items[${rowIndex}][stock_uom]" value="Unit" readonly></td>
                <td><input type="number" name="items[${rowIndex}][rate]" value="0" readonly></td>
                <td>
                    <select name="items[${rowIndex}][warehouse]" required>
                        <option value="">-- Choisir un entrepôt --</option>
                        <!-- Les options seront dynamiquement injectées par Thymeleaf -->
                        <th:block th:each="warehouse : ${warehouses}">
                            <option th:value="\${warehouse.warehouse_name}" th:text="\${warehouse.warehouse_name}"></option>
                        </th:block>
                    </select>
                </td>
                <td><button type="button" class="removeRow">Supprimer</button></td>
            `;

            itemsTableBody.appendChild(newRow);

            // Ajouter un événement de suppression pour cette nouvelle ligne
            newRow.querySelector(".removeRow").addEventListener("click", function () {
                newRow.remove();
                // Réindexation des lignes après suppression
                Array.from(itemsTableBody.children).forEach((row, index) => {
                    row.children[0].innerText = index + 1;
                    row.querySelectorAll("input, select").forEach(input => {
                        input.name = input.name.replace(/\[\d+\]/, `[${index}]`);
                    });
                });
            });
        });
    });
</script>


</body>
</html>
